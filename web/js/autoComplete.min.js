/*
 * @author Yoann RENARD
 * @version 1.1
 * @since 14/01/2011
 * Source : http://www.nodstrum.com/2007/09/19/autocompleter/
 * Plugin d'auto completion
 * Necessite jQuery
 * Developper sur jQuery 1.4.4
*/
(function($){$.fn.fill=function(thisValue){$(this).val(thisValue);setTimeout("$('#suggestions').hide();",200);};$.fn.lookup=function(inputString,rpc){if(inputString.length>0){$('#autoSuggestionsList').empty();var position=$(this).position();$('#suggestions').css({left:(position.left+30),top:(position.top+$(this).innerHeight())}).show();$("#loading").ajaxStart(function(){$(this).show();}).ajaxComplete(function(){$(this).hide();});var this_id=$(this).attr('id');$.getJSON(rpc+'?queryString='+inputString,function(data){if(data!=""&&data.items.length>0){$('#autoSuggestionsList').empty();$.each(data.items,function(key,value){var li=document.createElement("li");li.setAttribute("onClick","$('#"+this_id+"').fill('"+value+"')");li.appendChild(document.createTextNode(value));document.getElementById('autoSuggestionsList').appendChild(li);});$('#autoSuggestionsList li:first').addClass("hover");}else{$('#suggestions').hide();}});}};jQuery.fn.autoComplete=function(options){var settings={rpc:"rcp.php"};if(options){jQuery.extend(settings,options);}var suggestions=document.createElement("div");suggestions.setAttribute("class","suggestionsBox");suggestions.setAttribute("id","suggestions");var content=document.createElement("div");content.setAttribute("id","div_content");suggestions.appendChild(content);var img=document.createElement("img");img.setAttribute("src","upArrow.png");img.setAttribute("class","img_autoComplete");img.setAttribute("alt","upArrow");content.appendChild(img);var img=document.createElement("img");img.setAttribute("src","ajax-loader.gif");img.setAttribute("id","loading");content.appendChild(img);var autoSuggestionsList=document.createElement("ul");autoSuggestionsList.setAttribute("class","suggestionList");autoSuggestionsList.setAttribute("id","autoSuggestionsList");content.appendChild(autoSuggestionsList);$('body').prepend(suggestions);$(this).bind("keyup",function(e){var touche=window.event?e.keyCode:e.which;if((touche>=65&&touche<=90)||(touche>=49&&touche<=57)||(touche>=96&&touche<=105)||touche==48||touche==32||touche==8){$(this).lookup($(this).val(),settings.rpc);}if(touche==13){$(this).fill($('li.hover').html());}if(touche==40||touche==38){var selected_li;if((touche==40&&$('li.hover').next().html()==null)||(touche==38&&$('li.hover').prev().html()==null)){selected_li=(touche==40)?$('#autoSuggestionsList li:first'):$('#autoSuggestionsList li:last');}else{selected_li=(touche==40)?$('li.hover').next():$('li.hover').prev();}$('li.hover').removeClass('hover');selected_li.addClass('hover');$(this).val(selected_li.html());}}).bind("blur",function(){$(this).fill($(this).val());});return $(this);};})(jQuery)